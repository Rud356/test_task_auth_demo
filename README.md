# test_task_auth_demo
Тестовое задание для Effective Mobile.

## Установка из исходного кода
Предварительные требования:
- Установленный Python 3.13
- Установленный Docker и Docker-compose 

1. Создать виртуальное окружение на основе Python 3.13 командой `python -m venv venv`
2. Активировать виртуальное окружение командой `./venv/Scripts/activate` для Windows, или
`source ./venv/bin/activate` для Linux
3. Запустить базу данных при помощи Docker-compose из корневой папки проекта командой `docker compose up -d db`
4. Выполнить установку зависимостей с помощью `pip install -e .[migration]`
5. Выполнить миграции командой ` alembic upgrade head`
6. Для генерации тестовых данных запустить команду `python -m src.demo_api --create-demo-data`
7. Запустить сервер командой `python -m src.demo_api` (сервер запускается на порте 6060, 
конфигурация хранится в файле config.toml)

## Установка при помощи docker
Данный тип установки применяет передачу данных через файлы 
`docker_config.toml` и `docker_alembic.ini` в файлах проекта, передавая их в контейнер под именами
`config.toml` для конфигурации основного сервера, и `alembic.ini` для конфигурирования миграций БД.
Для запуска необходимо выполнить следующие команды:
- `docker-compose up` - Предварительная установка и запуск сервисов
- `docker exec -it demo_api_backend alembic upgrade head` - запуск миграций БД
- `docker exec -it demo_api_backend python -m src.demo_api --create-demo-data` - запуск создания тестовых данных

## Тестовые данные
Пользователи:
- demo_superuser@example.com:
  - Пароль: demoPASS1234
  - Права: Все
  - Роли: Demo role 1
  - Доступные ресурсы (Просмотр всех, Просмотр ресурса 1)
- demo_roles_1@example.com:
  - Пароль: demoPASS1234
  - Права: Никаких
  - Роли: Demo role 1
  - Доступные ресурсы (Просмотр и редактирование ресурса 1 и ресурса 2)
- demo_empty@example.com:
  - Пароль: demoPASS1234
  - Права: Никаких
  - Роли: Demo role 2
  - Доступные ресурсы (Просмотр и редактирование ресурса 2)

Ресурсы:
- Ресурс 1:
  - Автор: demo_roles_1@example.com
  - Доступ: Первый суперпользователь на просмотр и автор.
- Ресурс 2:
  - Автор: demo_roles_1@example.com
  - Доступ: Первый суперпользователь на просмотр, автор, пользователь 3 на редактирование и просмотр (от Роли 2).

Скрипт создания ресурсов располагается в файле src/demo_api/fake_data_setup.py

## Информация по умолчанию
Порт БД для внешнего доступа: 5433, логин postgres, пароль testpwd, БД - demo_db
Порт приложения - 6060

## Устройство системы управления доступа
Каждый пользователь имеет назначенные права,
распространяемые на всю систему. В них входит:
1. Управление ролями (поле edit_roles) - позволяет пользователю создавать,
изменять и удалять роли, а также выдавать или забирать их у пользователей;
2. Просматривать все ресурсы (поле view_all_resources);
3. Управлять пользователями (поле administrate_users) - позволяет обновлять информацию пользователей,
включая данные об учетной записи и управление сессиями;
4. Управление ресурсами (поле administrate_resources) - разрешает управлять ресурсами без предоставления отдельных прав.

Каждое назначение роли производится на пользователя.

Полный доступ к ресурсам всегда имеется у автора данного ресурса.
Остальные пользователи могут получить доступ на чтение при наличии
права просматривать все ресурсы, или при перезаписи права на просмотр ресурса
хотя бы у одной из имеющихся у него ролей.

Если пользователь имеет разрешение редактировать ресурс на одной из его ролей - 
пользователь также имеет право и просматривать ресурс.

Для управления доступом к ресурсам предоставляются следующие права:
1. Просмотр ресурсов;
2. Изменения ресурсов.

Обновление пароля пользователя вызывает прекращение всех имеющихся сессий пользователя.

Пользователь не может обновить список собственных ролей.

Пользователь не может выдать новому, созданному от его имени пользователю права,
которыми он сам не обладает на момент создания.